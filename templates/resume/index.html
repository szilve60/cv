<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>{% if profile %}{{ profile.name }}{% else %}CV{% endif %}</title>
    <link rel="stylesheet" href="/static/resume/style.css">
  </head>
  <body>
    <header class="site-header" role="banner">
      <a class="brand-btn" href="/">Szilveszter.</a>
      <div class="top-center-ctas">
        <a class="btn primary" href="#about">Rólam.</a>
        <a id="lang-toggle" class="btn outline" href="/en/">English</a>
      </div>
    </header>
    {% if profile %}
    <div class="cv-wrap hero">
      <div class="hero-left">
        <h1 class="hero-name">{{ profile.name }}</h1>
        <h2 class="hero-role">{% if cv_lang == 'en' and profile.title_en %}{{ profile.title_en }}{% else %}{{ profile.title }}{% endif %}</h2>


        <div class="hero-summary">
          {% if cv_lang == 'en' and profile.summary_en %}
            {% for line in profile.summary_en.splitlines %}
              {% if not 'linkedin' in line|lower %}
                <p>{{ line }}</p>
              {% endif %}
            {% endfor %}
          {% else %}
            {% for line in profile.summary.splitlines %}
              {% if not 'linkedin' in line|lower %}
                <p>{{ line }}</p>
              {% endif %}
            {% endfor %}
          {% endif %}
        </div>

        <div class="hero-links">
          {% if profile.linkedin %}
            <a class="social" href="{{ profile.linkedin }}" target="_blank" rel="noopener">LinkedIn</a>
          {% endif %}
        </div>
      </div>

      <div class="hero-right" role="img" aria-label="profile portrait">
        <img src="/static/resume/profile.png" alt="profile portrait">
      </div>
    </div>

    <section class="yellow-band" aria-hidden="false">
      <div class="yellow-inner">
        <div class="separator">{% if cv_lang == 'en' %}About.{% else %}Rólam.{% endif %}</div>

        <div class="exp-band">
          <div class="exp-inner">
            <div class="card card-experience exp-card-top">
              <h3>{% if cv_lang == 'en' %}Experience{% else %}Munkatapasztalat{% endif %}</h3>
              <ul>
                {% for e in profile.experiences.all %}
                  <li>
                    <strong>{% if cv_lang == 'en' and e.role_en %}{{ e.role_en }}{% else %}{{ e.role }}{% endif %}</strong> — {% if cv_lang == 'en' and e.company_en %}{{ e.company_en }}{% else %}{{ e.company }}{% endif %} <span class="dates">({{ e.start }} - {{ e.end }})</span>
                    <div class="desc">{% if cv_lang == 'en' and e.description_en %}{{ e.description_en }}{% else %}{{ e.description }}{% endif %}</div>
                  </li>
                {% empty %}
                  <li>Nincs megadva</li>
                {% endfor %}
              </ul>
            </div>
          </div>
        </div>

        <section id="about" class="about-section">
          <div class="about-cards">
        <div class="card card-education">
          <h3>{% if cv_lang == 'en' %}Education{% else %}Tanulmányok{% endif %}</h3>
          <ul>
            {% for ed in profile.education.all %}
              <li><strong>{% if cv_lang == 'en' and ed.degree_en %}{{ ed.degree_en }}{% else %}{{ ed.degree }}{% endif %}</strong> — {% if cv_lang == 'en' and ed.institution_en %}{{ ed.institution_en }}{% else %}{{ ed.institution }}{% endif %} <span class="dates">({{ ed.year }})</span></li>
            {% empty %}
              <li>{% if cv_lang == 'en' %}Not provided{% else %}Nincs megadva{% endif %}</li>
            {% endfor %}
          </ul>
        </div>

        <div class="card card-skills">
          <h3>{% if cv_lang == 'en' %}Skills{% else %}Készségek{% endif %}</h3>
          <ul class="skills-list">
            {% for s in profile.skills.all %}
              <li class="skill-pill">{% if cv_lang == 'en' and s.name_en %}{{ s.name_en }}{% else %}{{ s.name }}{% endif %}{% if s.level %} — {{ s.level }}{% endif %}</li>
            {% empty %}
              <li>{% if cv_lang == 'en' %}Not provided{% else %}Nincs megadva{% endif %}</li>
            {% endfor %}
          </ul>
        </div>

        <div class="card card-programming">
          <h3>{% if cv_lang == 'en' %}Software & Programming{% else %}Szoftver és programozási ismeretek{% endif %}</h3>
          <ul class="prog-list">
            {% for p in profile.programming_skills.all %}
              <li>
                <div class="prog-row">
                  <strong class="lang">{% if cv_lang == 'en' and p.language_en %}{{ p.language_en }}{% else %}{{ p.language }}{% endif %}</strong>
                  <div class="prog-bar" data-level="{{ p.level }}">
                    <div class="fill"></div>
                  </div>
                </div>
              </li>
            {% empty %}
              <li>{% if cv_lang == 'en' %}Not provided{% else %}Nincs megadva{% endif %}</li>
            {% endfor %}
          </ul>
        </div>

        
          </div>
        </section>
      </div>
    </section>
    <script>
      // Animate programming skill bars on DOMContentLoaded
      document.addEventListener('DOMContentLoaded', function () {
        const bars = Array.from(document.querySelectorAll('.card-programming .prog-bar'));
        bars.forEach((bar, i) => {
          const lvl = parseInt(bar.dataset.level || '0', 10);
          const fill = bar.querySelector('.fill');
          if (!fill) return;
          // stagger animation slightly per item
          const delay = 120 * i + 60;
          setTimeout(() => {
            const pct = Math.max(0, Math.min(5, lvl)) / 5 * 100;
            fill.style.width = pct + '%';
          }, delay);
        });
      });
    </script>
    <script>
      // Ensure the yellow band stretches to the bottom of the viewport below the hero
      function adjustYellowBand() {
        const hero = document.querySelector('.cv-wrap.hero');
        const band = document.querySelector('.yellow-band');
        if (!hero || !band) return;
        const heroRect = hero.getBoundingClientRect();
        const remaining = window.innerHeight - heroRect.height;
        band.style.minHeight = Math.max(320, remaining) + 'px';
      }
      window.addEventListener('load', adjustYellowBand);
      window.addEventListener('resize', adjustYellowBand);
      document.addEventListener('DOMContentLoaded', adjustYellowBand);
    </script>
    <script>
      // Lazy-reveal about cards using IntersectionObserver
      document.addEventListener('DOMContentLoaded', function () {
        const cards = Array.from(document.querySelectorAll('.about-cards .card'));
        if (!('IntersectionObserver' in window)) {
          // fallback: reveal all
          cards.forEach(c => c.classList.add('revealed'));
          return;
        }

        const io = new IntersectionObserver((entries, obs) => {
          entries.forEach(entry => {
            if (entry.isIntersecting) {
              entry.target.classList.add('revealed');
              obs.unobserve(entry.target);
            }
          });
        }, {root:null, rootMargin:'0px 0px -10% 0px', threshold: 0.12});

        cards.forEach((c, i) => {
          // stagger reveal by small delay when observed
          c.style.transitionDelay = (i * 120) + 'ms';
          io.observe(c);
        });
      });
    </script>
    <script>
      // On initial load, keep yellow-band hidden and disable page scrolling.
      // Reveal yellow-band and enable scrolling on first user interaction (wheel/touch/keydown/scroll).
      (function(){
        const band = document.querySelector('.yellow-band');
        if (!band) return;
        // Start locked
        document.documentElement.classList.add('initial-locked');
        document.body.style.overflow = 'hidden';

        function reveal() {
          document.body.style.overflow = '';
          band.classList.add('visible');
          removeListeners();
        }

        function onFirst(e){
          // allow keyboard navigation if arrow down / space / page down
          if (e.type === 'keydown'){
            const okKeys = ['ArrowDown','PageDown',' ',' '];
            if (!okKeys.includes(e.key)) return;
          }
          reveal();
        }

        function removeListeners(){
          window.removeEventListener('wheel', onFirst);
          window.removeEventListener('touchstart', onFirst);
          window.removeEventListener('keydown', onFirst);
          window.removeEventListener('scroll', onFirst);
        }

        window.addEventListener('wheel', onFirst, {passive:true});
        window.addEventListener('touchstart', onFirst, {passive:true});
        window.addEventListener('keydown', onFirst, {passive:true});
        window.addEventListener('scroll', onFirst, {passive:true});
      })();
    </script>
      <script>
        // Language toggle: set a cookie `cv_lang=en` so server-side templates render *_en fields.
        (function(){
          function setCookie(name, value, days){
            var expires = '';
            if (days){
              var date = new Date(); date.setTime(date.getTime() + (days*24*60*60*1000));
              expires = '; expires=' + date.toUTCString();
            }
            document.cookie = name + '=' + (value || '')  + expires + '; path=/';
          }
          function getCookie(name){
            var match = document.cookie.match(new RegExp('(^| )' + name + '=([^;]+)'));
            if (match) return match[2]; return null;
          }
          function eraseCookie(name){ setCookie(name,'',-1); }

          document.addEventListener('DOMContentLoaded', function(){
            const btn = document.querySelector('#lang-toggle');
            if(!btn) return;
            // initialize label depending on cookie
            if(getCookie('cv_lang') === 'en') btn.textContent = 'Magyar'; else btn.textContent = 'English';

            btn.addEventListener('click', function(e){
              e.preventDefault();
              if(getCookie('cv_lang') === 'en'){
                // switch to Hungarian: remove cookie and go to Hungarian root
                eraseCookie('cv_lang');
                window.location.href = '/';
              } else {
                // set cookie to English for 30 days, then navigate to the dedicated English page
                setCookie('cv_lang','en',30);
                window.location.href = '/en/';
              }
            });
          });
        })();
      </script>
    {% else %}
      <p style="padding:20px">No profile found. Create one in the admin panel.</p>
    {% endif %}
  </body>
</html>
